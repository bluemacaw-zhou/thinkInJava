#spring:
#  data:
#    mongodb:
#      uri: mongodb://appdb:michael@192.168.254.129:27017/appdb?authSource=appdb
#      # 连接池配置
#      connection-pool:
#        max-size: 50              # 最大连接数（默认100）
#        min-size: 5               # 最小连接数（默认0）
#        max-wait-time: 10000      # 获取连接最大等待时间（毫秒，默认120000）
#        max-connection-life-time: 0  # 连接最大存活时间（毫秒，0表示无限制）
#        max-connection-idle-time: 0  # 连接最大空闲时间（毫秒，0表示无限制）

      # 其他配置
#      connection-timeout: 10000    # 连接超时（毫秒）
#      socket-timeout: 0

spring:
  rabbitmq:
    host: 10.106.51.218
    port: 5672
    username: admin
    password: admin
    
    # 全局配置
    listener:
      simple:
        acknowledge-mode: manual  # 全局设置手动ACK模式
        prefetch: 16             # 全局prefetch设置，每个消费者预取20条消息
    
    exchangeMessage: 'ex.message'
    
    # 单条消息队列（实时数据）
    queueMessage: 'queue.message.single'
    routeMessage: 'route.message.single'

    # 批量消息队列（历史数据导入）
    queueMessageBatch: 'queue.message.batch'
    routeMessageBatch: 'route.message.batch'

    # Change Stream 事件队列配置
    # 所有 Collection 都使用 Fanout Exchange（广播模式，方便后续扩展）

    # Channel collection Fanout Exchange
    exchangeChangeStreamChannel: 'ex.changestream.channel.fanout'
    # Channel 变更队列 - ClickHouse 消费者
    queueChangeStreamChannelClickHouse: 'queue.changestream.channel.clickhouse'

    # UserSubscription collection Fanout Exchange
    exchangeChangeStreamUserSub: 'ex.changestream.usersub.fanout'
    # UserSubscription 变更队列 - ClickHouse 消费者
    queueChangeStreamUserSubClickHouse: 'queue.changestream.usersub.clickhouse'

    # Message collection Fanout Exchange
    exchangeChangeStreamMessage: 'ex.changestream.message.fanout'
    # Message 变更队列 - ClickHouse 消费者
    queueChangeStreamMessageClickHouse: 'queue.changestream.message.clickhouse'
    # Message 变更队列 - Redis 消费者
    queueChangeStreamMessageRedis: 'queue.changestream.message.redis'
    # Message 变更队列 - ES 消费者
    queueChangeStreamMessageES: 'queue.changestream.message.es'

mongodb:
  host: 10.106.51.218
  port: 27017
  database: im_message

  # Change Stream 配置
  change-stream:
    enabled: true                                         # 是否启用 Change Stream
    batch-size: 1000                                      # MongoDB 单次拉取事件数量（网络传输批次大小）
    max-await-time: 4000                                  # 没有事件时的等待时间（毫秒，4秒等待以捕获心跳）
    resume-token-collection: change_stream_resume_tokens  # 存储 resume token 的集合
    schedule-cron: 0/5 * * * * ?                          # 定时任务执行频率（每5秒执行一次）

  # Seq分配配置
  seq-assignment:
    boundary-date: 2026-01-06                             # seq分配的时间分界点（消息日期在此之前递减，之后递增）

  # Mock数据配置
  mock-data:
    total-users: 30000                                    # 用户总数（在线活跃用户）
    wind-user-ratio: 0.7                                  # Wind员工占比（70%）
    user-id-start: 100001                                 # 用户ID起始值（100001-130000）
    user-id-end: 130000                                   # 用户ID结束值

    total-groups: 1000                                    # 群总数
    min-group-members: 5                                  # 群最小成员数
    max-group-members: 20                                 # 群最大成员数
    group-id-start: 500001                                # 群ID起始值
    group-id-end: 501000                                  # 群ID结束值（500001-501000）

clickhouse:
  url: jdbc:clickhouse://10.106.51.218:8123/im_message
  username: admin
  password: admin
  database: im_message
  table: message

  # HikariCP连接池配置
  hikari:
    pool-name: ClickHousePool
    maximum-pool-size: 20          # 最大连接数
    minimum-idle: 5                # 最小空闲连接数
    connection-timeout: 30000      # 连接超时(毫秒)
    idle-timeout: 600000           # 空闲连接超时(10分钟)
    max-lifetime: 1800000          # 连接最大生存时间(30分钟)
    auto-commit: true
    connection-test-query: SELECT 1
